<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<!-- required libs -->
<link rel="stylesheet" href="css/reset-min.css" type="text/css">
<link rel="stylesheet" href="css/base-min.css" type="text/css">
<link rel="stylesheet" href="css/ui-lightness/jquery-ui-1.8.16.custom.css" type="text/css">
<link rel="stylesheet" href="css/iPhone-checkbox.css" type="text/css">
<link rel="stylesheet" href="css/main.css" type="text/css">
<script src="js/jquery-1.6.2.min.js" type="text/javascript"></script>
<script src="js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
<script src="js/iphone-style-checkboxes.js" type="text/javascript"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
<!-- own programs -->
<script src="js/correspondences.js" type="text/javascript"></script>
<script src="js/parser.js" type="text/javascript"></script>
<script type="text/javascript">
	
	var markersArray = [];
	
	
	
	function addMarker(location, map) {
			marker = new google.maps.Marker({
				position: location,
				map: map
			});
			markersArray.push(marker);
			return marker;
	};
	
	function cnvrt2Upper(str) {
        return str.toLowerCase().replace(/\b[a-z]/g, cnvrt);
        function cnvrt() {
            return arguments[0].toUpperCase();
        }
    }

    function createMarkerContent(vesselinfo){

 	var direction = new Array();
	direction["7"]="NW";
	direction["8"]="N";
	direction["9"]="N0";
	direction["6"]="0";
	direction["3"]="SO";
	direction["2"]="S";
	direction["1"]="SW";
	direction["4"]="W";
	direction["5"]="";
    	    	
   
       	content = 
       	"<div class='container'>"+
       	"<img  id='zentriert' border='0' src='http://images.vesseltracker.com/images/vessels/thumbnails/" + vesselinfo.pic +".jpg'/>"+
       	"<dl class='table-display'>"+
    	"<dt>Name</dt>"+
    	"<dd>"+cnvrt2Upper(vesselinfo.name)+"</dd>"+
    	"<dt>Schiffstyp</dt>"+
    	"<dd>"+vesselinfo.type+"</dd>"+
    	"<dt>Flagge</dt>"+
    	"<dd>"+ "<img src='http://images.vesseltracker.com/images/flags/"+ vesselinfo.flagid +".png'/> " + vesselinfo.nationality+"</dd>"+
    	"<dt>L&auml;nge x Breite</dt>"+
    	"<dd>"+ Math.round(vesselinfo.length) + "m x " + Math.round(vesselinfo.width)+"m</dd>"+
    	"<dt>Status</dt>"+
    	"<dd>"+vesselinfo.status+"</dd>"+
    	"<dt>Geschwindigkeit</dt>"+
    	"<dd>"+vesselinfo.speed+"kn</dd>"+
    	"<dt>Kurs / Richtung</dt>"+
    	"<dd>"+vesselinfo.course+"&deg; / "+ direction[vesselinfo.icon]+"</dd>"+
    	//"<dt>Tiefgang</dt>"+
    	//"<dd>"+vesselinfo.
    	"</dl>"+
    	"</div>"
    	
    	console.log(content);
    	return content;
    };
//http://images.vesseltracker.com/images/flags/221.png
  $(function(){
  
    var latlng = new google.maps.LatLng(53.890582,10.701184);
    var myOptions = {
      zoom: 14,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.TERRAIN
    };
    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    var kml = new google.maps.KmlLayer('http://itm.github.com/Tor-zur-Ostsee/region.kml');
    var infowindow = new google.maps.InfoWindow({
				content: "Oi"
		});

    
    $( "#radio form" ).buttonset();
    var elems = $("#radio input[type=radio]");
    elems.click( function(ev) {
    	var lat = parseFloat($(ev.target).data("lat"));
    	var lon = parseFloat($(ev.target).data("long"));
    	var zom = parseInt($(ev.target).data("zoom"));
    	map.panTo(new google.maps.LatLng(lat,lon));
    	map.setZoom(zom);
    });
    downloadXml("data.xml", function(data) {
    	var vessels = parseXml(data);
    	$(vessels).each( function() {
    			marker = addMarker(new google.maps.LatLng(this.lat, this.lon), map);
    			marker.vessel = this;
    			google.maps.event.addListener(marker, 'click', function() {
						content = createMarkerContent(this.vessel);
						infowindow.setContent(content);
						infowindow.open(map, this);
					});
		  });

    });
    
    // trigger click with next on timer
    var i     = 0;
    var changeCenter = function() {
    	i++;
    	if ( i >= elems.size() ) {
    		i = 0;
    	}
    	$(elems[i]).trigger("click");
    };
		var myTimer = window.setInterval(changeCenter, 10000);
		
		$('#on_off').attr('checked', 'checked');
		$('#on_off').iphoneStyle({
			checkedLabel: 'Auto',
			uncheckedLabel: 'Off',
			onChange: function(elem, value) { 
      	window.clearInterval(myTimer);
      	kml.setMap(map);
				if ( $(elem).attr('checked') ) {
					myTimer = window.setInterval(changeCenter, 10000);
					kml.setMap(null);
				}
			}
    });
		
  });

</script>
</head>
	<div id="radio">
		<form>
			<input type="radio" id="radio2" name="radio" data-lat="53.890582" data-long="10.701184" data-zoom="13" checked="checked" /><label for="radio2">Innenstadt</label>
			<input type="radio" id="radio5" name="radio" data-lat="53.9199" data-long="10.825" data-zoom="11" />
			<input type="radio" id="radio3" name="radio" data-lat="53.895539" data-long="10.796957" data-zoom="14" /><label for="radio3">Seelandkai &amp; Schlutup</label>
			<input type="radio" id="radio4" name="radio" data-lat="53.9199" data-long="10.825" data-zoom="11" />
			<input type="radio" id="radio1" name="radio" data-lat="53.957146" data-long="10.864348" data-zoom="14"/><label for="radio1">Travem&uuml;nde</label>
			<input type="radio" id="radio6" name="radio" data-lat="53.9199" data-long="10.825" data-zoom="11" />
			<input type="radio" id="radio7" name="radio" data-lat="54.058985" data-long="10.931282" data-zoom="11" /><label for="radio7">L&uuml;becker Bucht</label>
		</form>
		<div style="position:absolute; right:10px; top:11px;">
			<input type="checkbox" id="on_off"/>
		</div>
	</div>

  <div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>
