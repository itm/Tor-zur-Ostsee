<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<!-- required libs -->
		<link rel="stylesheet" href="css/reset-min.css" type="text/css">
		<link rel="stylesheet" href="css/base-min.css" type="text/css">
		<link rel="stylesheet" href="css/ui-lightness/jquery-ui-1.8.16.custom.css" type="text/css">
		<link rel="stylesheet" href="css/iPhone-checkbox.css" type="text/css">
		<link rel="stylesheet" href="css/main.css" type="text/css">
		<script src="js/jquery-1.6.2.min.js" type="text/javascript"></script>
		<script src="js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
		<script src="js/iphone-style-checkboxes.js" type="text/javascript"></script>
		<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
		<!-- own programs -->
		<script src="js/correspondences.js" type="text/javascript"></script>
		<script src="js/parser.js" type="text/javascript"></script>
		<script src="js/ais-formatter.js" type="text/javascript"></script>
		<script type="text/javascript">
			var markersArray = [];

			function addMarker(location, map) {
				marker = new google.maps.Marker({
					position : location,
					map : map
				});
				markersArray.push(marker);
				return marker;
			};


			$(function() {

				var myOptions = {
					zoom : 14,
					center : new google.maps.LatLng(53.890582, 10.701184),
					mapTypeId : google.maps.MapTypeId.TERRAIN,
					disableDefaultUI: true
				};
				var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
				var kml = new google.maps.KmlLayer('http://itm.github.com/Tor-zur-Ostsee/region.kml');
				var infowindow = new google.maps.InfoWindow({
					content : "Oi"
				});
				
				var logoDiv = document.createElement('DIV');
				$(logoDiv).html('<img alt="logo" src="img/logo.png" />');
				map.controls[google.maps.ControlPosition.TOP_LEFT].push(logoDiv);

				$("#radio form").buttonset();
				var elems = $("#radio input[type=radio]");
				elems.click(function(ev) {
					var lat_sw = parseFloat($(ev.target).data("lat-sw"));
					var lon_sw = parseFloat($(ev.target).data("long-sw"));
					var lat_ne = parseFloat($(ev.target).data("lat-ne"));
					var lon_ne = parseFloat($(ev.target).data("long-ne"));
					var sw = new google.maps.LatLng(lat_sw, lon_sw);
					var ne = new google.maps.LatLng(lat_ne, lon_ne);
					var bounds = new google.maps.LatLngBounds(sw, ne);
					map.fitBounds(bounds);
				});
				
				downloadXml("data.xml", function(data) {
					var vessels = parseXml(data);
					$(vessels).each(function() {
						marker = addMarker(new google.maps.LatLng(this.lat, this.lon), map);
						marker.vessel = this;
						google.maps.event.addListener(marker, 'click', function() {
							content = createMarkerContent(this.vessel);
							infowindow.setContent(content);
							infowindow.open(map, this);
						});
					});
				});
				// trigger click with next on timer
				var i = 0;
				var changeCenter = function() {
					i++;
					if(i >= elems.size()) {
						i = 0;
					}
					$(elems[i]).trigger("click");
				};
				var myTimer = window.setInterval(changeCenter, 10000);

				$('#on_off').attr('checked', 'checked');
				$('#on_off').iphoneStyle({
					checkedLabel : 'Auto',
					uncheckedLabel : 'Off',
					onChange : function(elem, value) {
						window.clearInterval(myTimer);
						kml.setMap(map);
						if($(elem).attr('checked')) {
							myTimer = window.setInterval(changeCenter, 10000);
							kml.setMap(null);
						}
					}
				});

			});

		</script>
	</head>
	<div id="radio">
		<form>
			<input type="radio" id="radio1" name="radio" checked="checked"
				data-lat-sw="53.854349" data-long-sw="10.647726" 
				data-lat-ne="53.878946" data-long-ne="10.732956" 
			/>
			<label for="radio1">Altstadt</label>

			<input type="radio" id="radio2" name="radio"
				data-lat-sw="53.887952" data-long-sw="10.734844" 
				data-lat-ne="53.908484" data-long-ne="10.833721" 
			/>
			<label for="radio2">Lehmannkai, Seelandkai, Terminal Schlutup</label>
			
			<input type="radio" id="radio3" name="radio"
				data-lat-sw="53.878643" data-long-sw="10.647297" 
				data-lat-ne="53.900596" data-long-ne="10.735517" 
			/>
			<label for="radio3">Konstinkai, Nordlandkai</label>
			
			<input type="radio" id="radio4" name="radio"
				data-lat-sw="53.936132" data-long-sw="10.838563" 
				data-lat-ne="53.950227" data-long-ne="10.877616" 
			/>
			<label for="radio4">Skandinavienkai</label>
			
			<input type="radio" id="radio5" name="radio"
				data-lat-sw="53.954621" data-long-sw="10.859027" 
				data-lat-ne="53.954621" data-long-ne="10.859027" 
			/>
			<label for="radio5">Travem&uuml;nde</label>
			
		</form>
		<div style="position:absolute; right:10px; top:11px;">
			<input type="checkbox" id="on_off"/>
		</div>
	</div>
	<div id="map_canvas" style="width:100%; height:100%"></div>
	</body>
</html>
